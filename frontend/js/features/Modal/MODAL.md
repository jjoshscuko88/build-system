# Модалки

**На этой сборки настройки перенесены в `index.js`**

Модалки внутри используют `vpopape`. Поэтому с ними можно делать всё, что можно делать с экземплярами этой библиотеки.

В этом проекте класс `Vpopape` доступен глобально, а документация по библиотеке тут: `resources/js/libs/vpopape/docs.html`.

#### Где исходники

- Основной файл: `resources/js/features/Modal/index.js`;
- Настройки (шаблоны, классы, аттрибуты, ...): `resources/js/features/Modal/settings.js`;
- Стили: `resources/scss/includes/features/_modal.scss`;

#### Использование

Модалки идентифицируются по аттрибуту `id`. Если у HTML-элемента нет `id`, будет присвоен встроенный с автоинкрементом.

- Модалки можно вызывать из JS.
- Ими можно управлять с помощью data-аттрибутов.
- Любую созданную модалку можно как открывать из JS, так и с помощью data-аттрибута.

**Чтобы включить слежение за data-аттрибутами** где-нить в главном модуле надо сделать так:
```javascript
import Modal from 'js/features/Modal';
Modal.listenDataAttributes();
```

- Ниже перечислены не все, но несколько способов использования.
- Можно сделать что-то более сложное, для этого добро пожаловать в исходники. Для начала стоит посмотреть на опции конструктора, а если потребуется – добавить туда новые опции и фичи.

###### Создать модалку в JS из существующего HTML-элемента

1. Создать HTML-элемент с какими-нибудь содержимым внутри;
1. Этот HTML-элемент обязательно должен иметь CSS-класс `modal` и какой-нить id, пускай будет `some-id-1`;
1. Создать модалку: `const modal1 = new Modal({ htmlId: 'some-id-1' })`;
1. Открыть модалку: `modal.vpopape.showPopup()`;
1. Закрыть модалку: `modal.vpopape.hidePopup()`. Также модалку может закрыть пользователь по клику на «крестик» или вне модалки;

Можно создать модалку, которую пользователь не сможет закрыть самостоятельно. Для этого при создании надо передать опцию: `noClosers`:

```javascript
const modal1 = new Modal({
  htmlId: 'some-id-1',
  noClosers: true,
});
```

###### Создать модалку прямо в JS

Если в HTML-документе элемент с id `some-id-2` не будет найден, то модалка с таким id и необходимой структурой будет создана автоматически. HTML-содержимое можно передать в свойстве `htmlContent`:

```javascript
const modal2 = new Modal({
  htmlId: 'some-id-2',
  htmlContent: 'Я <i>содержимое модалки</i>, <b>которая была создана из JS</b>!',
});

// А теперь откроем эту модалку.
modal2.vpopape.showPopup();
```

###### Вызов модалок с помощью data-аттрибутов

Любую из созданных ранее модалок можно открыть по клику на что-нибудь с `data-modal-caller` аттрибутом:

```html
<button data-modal-caller="some-id-1">Открыть модалку `some-id-1`</button>
<p>Аттрибут `data-modal-caller` отменяет действие браузера по умолчанию, клик по этой ссылке просто откроет модалку:</p>
<a href="http://ya.ru" data-modal-caller="some-id-2">Открыть модалку `some-id-2`</a>
```

Также можно не создавать вообще никаких модалок заранее. Тогда пустая модалка будет созданна автоматически.

От пустой модалки особо проку нет, поэтому можно воспользоваться аттрибутом `data-modal-clone-from`:

```html
<button data-modal-caller="new-id-1" data-modal-clone-from="element-to-clone-1">Открыть модалку</button>
<div id="element-to-clone-1">Содержимое, <b>которое будет склонировано в новый попап</b></div>
```

#### Доп. возможности

Реализованы замены стандартным модалкам.

###### Modal.alert

```javascript
// Просто текст.
Modal.alert('Это очень важное сообщение');

// HTML
Modal.alert(`
  <h1>Важное сообение</h1>
  <p>Тексто очень важного сообения</p>
`);
```

Можно показать текст в алерте по клику на кнопку с аттрибутом `data-modal-alert`:
```html
<button data-modal-alert="Этот текст будет показан в модалке, по клику на эту кнопку">
  Показать какой-то текст
</button>
```

###### Modal.confirm

Показывает модалку пользователю с сообщением.
- Если пользователь нажмёт «Отмена», модалка просто закроется;
- Если пользователь нажмёт «Ок», выполнится переданная функция;

```javascript
Modal.confirm(
  'Здесь текст или HTML, в котором спрашивается что-то...',
  // Второй аргумент – функция, которая будет запущена, если пользователь нажмет «Ок».
  function(whatToDo) {
    console.log('Сделать что-то ' + whatToDo);
  }
);

// В третьем аргументе можно передать что-то функции: 
function doSmth(type) {
  console.log('Сделать что-то ' + type);
}

// Сделает хорошо по желанию пользователя.
Modal.confirm(
  'Сделать что-то хорошее',
  doSmth,
  'хорошее'
);

// Сделает плохо по желанию пользователя.
Modal.confirm(
  'Сделать что-то плохое',
  doSmth,
  'плохое'
);
```

Как обычно, эту возможность можно использовать с аттрибутами:
- `data-modal-confirm` – текст или HTML в модалке;
- `data-modal-confirm-cb` – функция, которая будет выполнена по нажатию на ОК;
- `data-modal-confirm-param` – Параметр, который будет передан функции;

Так как содержиое атрибутов – это строки, методу `Modal.confirm()` вместо функции можно передать строку с «путём» до функции, которая досупна из глобальной области видимости:

```html
<script>
    window.someGlobalObj = {
      someProp: {
        someValue: 5,
        someMethod: function(val) {
          console.log('Эта функция доступна из глобальной области видимости');
          console.log('Мне передали такую строку: ' + val);
        }
      }
    }
</script>

<button
  data-modal-confirm="Точно запустить?"
  data-modal-confirm-cb="someGlobalObj.someProp.someMethod"
  data-modal-confirm-param="Строка, которая будет переданна колбэку"
>Запустить?</button>
